// ESBuild æ¨ªå¹…æ’ä»¶
// åœ¨æ‰“åŒ…æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ç‰ˆæƒä¿¡æ¯å’Œæ„å»ºä¿¡æ¯

export function bannerPlugin(options = {}) {
  return {
    name: 'banner-plugin',
    setup(build) {
      const {
        banner = '// Generated by ESBuild',
        includeTimestamp = true,
        includeVersion = true,
        author = 'ESBuild Learning Project',
        license = 'MIT'
      } = options;
      
      build.onEnd((result) => {
        console.log('ğŸ¯ æ¨ªå¹…æ’ä»¶ï¼šæ„å»ºå®Œæˆï¼Œæ·»åŠ æ¨ªå¹…ä¿¡æ¯');
        
        // åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ åå¤„ç†é€»è¾‘
        // ä¾‹å¦‚æ–‡ä»¶å¤„ç†ã€ç»Ÿè®¡ä¿¡æ¯ç­‰
      });
      
      // è®¾ç½®æ„å»ºé€‰é¡¹ä¸­çš„æ¨ªå¹…
      build.initialOptions.banner = build.initialOptions.banner || {};
      build.initialOptions.banner.js = createBanner({
        banner,
        includeTimestamp,
        includeVersion,
        author,
        license
      });
    }
  };
}

function createBanner({ banner, includeTimestamp, includeVersion, author, license }) {
  const lines = [
    banner,
    `// Author: ${author}`,
    `// License: ${license}`
  ];
  
  if (includeTimestamp) {
    lines.push(`// Build Time: ${new Date().toISOString()}`);
  }
  
  if (includeVersion) {
    lines.push(`// ESBuild Version: ${process.env.npm_package_version || '1.0.0'}`);
  }
  
  lines.push('//');
  
  return lines.join('\n');
}
